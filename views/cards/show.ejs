<%- include('../partials/header') %>

<div class="container mx-auto px-4 py-8">
  <div class="max-w-[300px] mx-auto"> <!-- Réduit la largeur maximale -->
    <!-- Card Container -->
    <div class="relative">
      <!-- Card Frame -->
      <div class="bg-gradient-to-b rounded-2xl overflow-hidden shadow-xl transform hover:scale-105 transition-transform duration-200
        <% if (card.type === 'Fire') { %>from-red-400 to-orange-500
        <% } else if (card.type === 'Water') { %>from-blue-400 to-blue-600
        <% } else if (card.type === 'Grass') { %>from-green-400 to-green-600
        <% } else if (card.type === 'Electric') { %>from-yellow-300 to-yellow-500
        <% } else if (card.type === 'Psychic') { %>from-purple-400 to-purple-600
        <% } else if (card.type === 'Fighting') { %>from-orange-400 to-orange-600
        <% } else { %>from-gray-300 to-gray-500<% } %>">
        
        <!-- Card Header -->
        <div class="p-2 flex justify-between items-center">
          <h1 class="text-lg font-bold text-white"><%= card.name %></h1>
          <span class="text-white font-bold text-sm">HP <%= card.hp %></span>
        </div>

        <!-- Card Image -->
        <div class="bg-gradient-to-b from-white to-gray-100 mx-2 rounded-lg">
          <img src="<%= card.imageUrl %>" alt="<%= card.name %>" 
            class="w-full h-40 object-contain p-1">
        </div>

        <!-- Card Type and Rarity -->
        <div class="px-2 py-1 flex justify-between items-center text-sm">
          <div class="flex items-center space-x-1">
            <span class="w-5 h-5 rounded-full flex items-center justify-center
              <% if (card.type === 'Fire') { %>bg-red-600
              <% } else if (card.type === 'Water') { %>bg-blue-600
              <% } else if (card.type === 'Grass') { %>bg-green-600
              <% } else if (card.type === 'Electric') { %>bg-yellow-500
              <% } else if (card.type === 'Psychic') { %>bg-purple-600
              <% } else if (card.type === 'Fighting') { %>bg-orange-600
              <% } else { %>bg-gray-500<% } %>">
              <span class="text-white text-xs font-bold"><%= card.type.charAt(0) %></span>
            </span>
            <span class="text-white text-xs"><%= card.type %></span>
          </div>
          <span class="px-2 py-0.5 rounded text-xs font-bold
            <% if (card.rarity === 'Common') { %>bg-gray-200 text-gray-700
            <% } else if (card.rarity === 'Uncommon') { %>bg-green-200 text-green-700
            <% } else if (card.rarity === 'Rare') { %>bg-blue-200 text-blue-700
            <% } else if (card.rarity === 'Ultra Rare') { %>bg-purple-200 text-purple-700
            <% } else if (card.rarity === 'Secret Rare') { %>bg-yellow-200 text-yellow-700<% } %>">
            <%= card.rarity %>
          </span>
        </div>

        <!-- Attacks Section -->
        <div class="bg-white mx-2 rounded-lg mb-2">
          <% if (card.attacks && card.attacks.length > 0) { %>
            <% card.attacks.forEach(attack => { %>
              <div class="p-1.5 border-b border-gray-200 last:border-0">
                <div class="flex justify-between items-center">
                  <div class="flex items-center space-x-1">
                    <% attack.cost.forEach(energy => { %>
                      <span class="w-4 h-4 rounded-full flex items-center justify-center
                        <% if (energy === 'Fire') { %>bg-red-500
                        <% } else if (energy === 'Water') { %>bg-blue-500
                        <% } else if (energy === 'Grass') { %>bg-green-500
                        <% } else if (energy === 'Electric') { %>bg-yellow-400
                        <% } else if (energy === 'Psychic') { %>bg-purple-500
                        <% } else if (energy === 'Fighting') { %>bg-orange-500
                        <% } else { %>bg-gray-400<% } %>">
                        <span class="text-white text-xs font-bold"><%= energy.charAt(0) %></span>
                      </span>
                    <% }); %>
                    <span class="text-sm font-semibold"><%= attack.name %></span>
                  </div>
                  <span class="text-sm font-bold"><%= attack.damage %></span>
                </div>
              </div>
            <% }); %>
          <% } %>
        </div>

        <!-- Card Footer -->
        <div class="bg-white mx-2 rounded-lg mb-2 p-1.5">
          <div class="grid grid-cols-2 gap-1 text-xs">
            <% if (card.weakness) { %>
              <p class="text-gray-600">
                <span class="font-semibold">Faiblesse:</span>
                <span class="<% if (card.weakness === 'Fire') { %>text-red-600
                  <% } else if (card.weakness === 'Water') { %>text-blue-600
                  <% } else if (card.weakness === 'Grass') { %>text-green-600
                  <% } else if (card.weakness === 'Electric') { %>text-yellow-600
                  <% } else if (card.weakness === 'Psychic') { %>text-purple-600
                  <% } else if (card.weakness === 'Fighting') { %>text-orange-600
                  <% } else { %>text-gray-600<% } %>">
                  <%= card.weakness %>
                </span>
              </p>
            <% } %>
            <% if (card.resistance) { %>
              <p class="text-gray-600">
                <span class="font-semibold">Résist:</span>
                <span class="<% if (card.resistance === 'Fire') { %>text-red-600
                  <% } else if (card.resistance === 'Water') { %>text-blue-600
                  <% } else if (card.resistance === 'Grass') { %>text-green-600
                  <% } else if (card.resistance === 'Electric') { %>text-yellow-600
                  <% } else if (card.resistance === 'Psychic') { %>text-purple-600
                  <% } else if (card.resistance === 'Fighting') { %>text-orange-600
                  <% } else { %>text-gray-600<% } %>">
                  <%= card.resistance %>
                </span>
              </p>
            <% } %>
            <p class="text-gray-600 <span class="font-semibold">Retraite:</span> <%= card.retreatCost %>
            </p>
          </div>
        </div>

        <!-- Serial Number and Owner -->
        <div class="px-2 pb-2">
          <div class="text-[10px] text-white/80 flex justify-between items-center">
            <% if (card.serialNumber) { %>
              <span>№ <%= card.serialNumber %></span>
            <% } %>
            <span>© <%= card.owner?.username || 'Pool général' %></span>
          </div>
        </div>
      </div>
    </div>

    <!-- Action Buttons -->
    <% if (user && (user.role === 'admin' || user.id === card.owner?.toString())) { %>
      <div class="mt-4 flex justify-center space-x-3">
        <a href="/cards/<%= card._id %>/edit" 
          class="px-3 py-1.5 bg-blue-500 text-white text-sm rounded hover:bg-blue-600 transition">
          Modifier
        </a>
        <button onclick="confirmDelete('<%= card._id %>')" 
          class="px-3 py-1.5 bg-red-500 text-white text-sm rounded hover:bg-red-600 transition">
          Supprimer
        </button>
      </div>
    <% } %>

    <div class="mt-4 text-center">
      <a href="/cards" class="text-blue-500 hover:text-blue-700 text-sm">
        Retour à la liste
      </a>
    </div>
  </div>
</div>

<script>
function confirmDelete(cardId) {
  if (confirm('Êtes-vous sûr de vouloir supprimer cette carte ?')) {
    fetch(`/cards/${cardId}`, {
      method: 'DELETE',
      credentials: 'same-origin',
      headers: {
        'Content-Type': 'application/json'
      }
    })
    .then(response => response.json())
    .then(data => {
      if (data.success) {
        window.location.href = '/cards';
      } else {
        alert('Erreur lors de la suppression de la carte');
      }
    })
    .catch(error => {
      console.error('Erreur:', error);
      alert('Erreur lors de la suppression de la carte');
    });
  }
}
</script>

<%- include('../partials/footer') %>
